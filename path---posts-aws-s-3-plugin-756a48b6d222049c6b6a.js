webpackJsonp([0x68afbe56aba0],{454:function(n,s){n.exports={data:{site:{siteMetadata:{title:"前端小誌",author:"Ernie Yang"}},markdownRemark:{id:"/Users/ernieyang09/Desktop/workspace/gatsby-blog/src/pages/posts/2017/09/0930--aws_s3_plugin.md absPath of file >>> MarkdownRemark",html:'<p>承前幾天寫的文章，我也忘記為什麼突然search到這個plugin，看了一下可以自動化上傳，於是就跳下去了...</p>\n<p>試了一陣子，了解了之後其實很簡單</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js">$ npm i webpack<span class="token operator">-</span>s3<span class="token operator">-</span>plugin</code></pre>\n      </div>\n<p>webpack設定</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  config<span class="token punctuation">.</span>webpack<span class="token punctuation">.</span>extra<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>\n    <span class="token keyword">new</span> <span class="token class-name">S3Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// s3Options are required</span>\n      s3Options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        accessKeyId<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">AWS_ACCESS_KEY</span><span class="token punctuation">,</span>\n        secretAccessKey<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">AWS_SECRET_ACCESS_KEY</span><span class="token punctuation">,</span>\n        region<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">AWS_REGION</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      s3UploadOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        Bucket<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">AWS_BUCKET</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      cloudfrontInvalidateOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Automatically invalidate your Cloudfront distribution cache every time you upload your code</span>\n        DistributionId<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">CLOUDFRONT_DISTRIBUTION_ID</span><span class="token punctuation">,</span>\n        Items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"/*"</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Bucket就是你S3的bucket，region請<a href="http://docs.aws.amazon.com/general/latest/gr/rande.html">參照此</a></p>\n<p>先講cloudfront部份，cloudfront有cache機制，預設是86400秒(一天)，如果要提前就要讓其失效(Invalidation)。關於失效的可以參考<a href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Invalidation.html#InvalidationLimits">這裡</a>，看起來是算更新次數而不是更新檔案，1000次非常夠用。</p>\n<p>再來就是accessId跟Key，一開始找不到在哪，問了同事要從IAM設一個新user，然後將AmazonS3FullAccess與CloudFrontFullAccess加上，不想用Invalidation不需要後面的權限，這樣就完成囉!!</p>\n<p>其實我相信真的有在大量使用AWS的公司，應該都會有DevOps做自動化流程，這套件也是將s3 cli包進來做指令。因為之前是微軟體系的，然後後來對前端比較有興趣，這次稍微碰了一下，AWS很強大，在很多服務中很容易不知道該做什麼，真的S難QAQ</p>',fields:{slug:"/posts/aws_s3_plugin/"},frontmatter:{title:"Webpack S3 plugin",date:"2017-09-30T21:57",tags:["webpack"]}}},pathContext:{slug:"/posts/aws_s3_plugin/"}}}});
//# sourceMappingURL=path---posts-aws-s-3-plugin-756a48b6d222049c6b6a.js.map